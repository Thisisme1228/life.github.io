<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>js的性能优化 - Helene's blog</title>

	<link rel="shortcut icon" href="/styles/images/favicon.icon">
	<link rel="icon" href="/styles/images/favicon.ico">

	<link rel="stylesheet" href="/styles/css/index.css">
	<link rel="stylesheet" href="/styles/css/fontawesome/css/font-awesome.min.css">
	<link rel="stylesheet" href="/styles/css/syntax.css">
	<link rel="canonical" href="/2016/05/03/Capabilities/">
	<link rel="alternate" type="application/rss+xml" title="Helene's blog" href="/feed.xml">
	
	<meta name="keywords" content="js的性能优化, Helene's blog, 厚积薄发">
	<meta name="description" content="厚积薄发">

	<script src="/styles/js/jquery.min.js"></script>
	<!--[if lt IE 9]>
    	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  	<![endif]-->
  	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
  	<style type="text/css">
	  	.docs-content{
	  		margin-bottom: 10px;
	  	}
  	</style>
</head>

  <body class="index">

    <header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <!--<img src="/styles/images/logo.png" style="width: auto;height: 40px;">-->
        <span style="font-size: 20px">Helene</span>
      </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">    
        <li>
          <a href="/">首页</a>
        </li>
        <li>
          <a href="/greens/">生活</a>
        </li>
        <li>
          <a href="/rice">工作</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <!--<li>
            <a><span id="busuanzi_container_site_pv">客流量<span id="busuanzi_value_site_pv"></span>次</span></a>
        </li>-->
        <li>
          <a href="http://resume.thisisme1228.com/index.html">我的简历</a>
        </li>
        <li>
          <a href="/donate/">打赏我</a>
        </li>
        <!--<li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">关于我<b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a rel="nofollow" target="_blank" href="https://github.com/Thisisme1228">Github</a></li>
            <li><a rel="nofollow" target="_blank" href="">关于作者</a></li>
            <li><a rel="nofollow" href="/books">我的书单</a></li>
            <li><a rel="nofollow" href="http://www.hifreud.com/domains/">域名管理</a></li>
            <li><a rel="nofollow" href="/reference">推荐博客</a></li>
            <li><a href="/feed.xml">RSS订阅</a></li>
            <li class="divider"></li>
            <li><a rel="nofollow" target="_blank" href="https://github.com/luoyan35714/LessOrMore.git">本项目</a></li>
          </ul>
        </li>-->
      </ul>
    </nav>
  </div>
</header>
    <div class="docs-header" id="content">
  <div class="container">
  	
		    <!--<h1>js的性能优化</h1>-->
		    <!--<p>Post on May 03, 2016 by <a href="/about">Helene</a></p>-->
		    <h1>别空有皮囊</h1>
    
      <audio style="display:none;" controls  loop="loop"  id="h5audio_media"  preload="auto" height="0" width="0" src="./../styles/Demi-Lovato-This-Is-Me.mp3">
          <source src="./../styles/Demi-Lovato-This-Is-Me.mp3">
      </audio>
      <div style="display: inline-block;position: absolute;right: 0;top: 0;cursor: pointer" id="radio">
          <img  src="./../styles/images/radio.png" style="display: block;width: 50px;height: auto;">
          <span style="color: beige" id="clickMe">Click!</span>
      </div>
  </div>
</div>
<script>
    var radio = document.getElementById('radio');
    var h5audio_media = document.getElementById('h5audio_media');

    radio.addEventListener('click',function () {
        if(h5audio_media != ''){
            //检测播放是否已暂停.audio.paused 在播放器播放时返回false.
            if (h5audio_media.paused) {
                h5audio_media.play();// 这个就是播放
                clickMe.innerText = '哇哦'
            } else {
                h5audio_media.pause();// 这个就是暂停
                clickMe.innerText = 'Click!'
            }
        }
    })
</script>
<style>
    #clickMe
    {
        position:relative;
        animation:myfirst .2s infinite;
        animation-direction:alternate;
        /* Safari and Chrome */
        -webkit-animation:myfirst .2s infinite;
        -webkit-animation-direction:alternate;
    }
    @keyframes myfirst
    {
        0%   {left:-5px; top:0px;}
        100% { left:10px; top:0px;}
    }

    @-webkit-keyframes myfirst /* Safari and Chrome */
    {
        0%   {left:-5px; top:0px;}
        100% {left:10px; top:0px;}
    }
</style>
    
      
<div class="banner">
  <div class="container">
  	
    	<a href="/greens/#-ref"></a>	/
    	<a href="/rice/#性能-ref">性能</a>
    
  </div>
</div>

    

    <div class="container docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <!-- 打赏页面左面 -->
<div id="navigation">
  <h1>目录</h1>
  <ul class="nav sidenav">
  </ul>
  <div style="height: 200px;width: 200px;">

  </div>
</div>

 
      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
            <header class="post-header">
              <h1 class="post-title">js的性能优化</h1>
                <span class="post-meta" style="margin-right: 30px">Date：May 3, 2016</span>
                <span class="meta">Author：<a target="_blank" href="http://localhost:4000">Helene</a></span>
              <br />
              <blockquote style="margin-top: 20px"><p>本文章采用<a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh"> 知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议 </a>进行许可。转载请注明来自<a href="http://life.thisisme1228.com/">Helene的博客</a></p></blockquote>
            </header>
            <article class="post-content">
              <ul id="markdown-toc">
  <li><a href="#one" id="markdown-toc-one">1、避免全局查找</a></li>
  <li><a href="#two" id="markdown-toc-two">2、定时器</a></li>
  <li><a href="#three" id="markdown-toc-three">3、字符串连接</a></li>
  <li><a href="#four" id="markdown-toc-four">4、数字转换成字符串</a></li>
  <li><a href="#five" id="markdown-toc-five">5、浮点数转换成整型</a></li>
  <li><a href="#six" id="markdown-toc-six">6、多个类型声明</a></li>
  <li><a href="#seven" id="markdown-toc-seven">7、插入迭代器</a></li>
  <li><a href="#eight" id="markdown-toc-eight">8、使用直接量</a></li>
  <li><a href="#nine" id="markdown-toc-nine">9、使用DocumentFragment优化多次append</a></li>
  <li><a href="#ten" id="markdown-toc-ten">10、使用一次innerHTML赋值代替构建dom元素</a></li>
  <li><a href="#eleven" id="markdown-toc-eleven">11、使用firstChild和nextSibling代替childNodes遍历dom元素</a></li>
  <li><a href="#twelve" id="markdown-toc-twelve">12、删除DOM节点</a></li>
  <li><a href="#thirteen" id="markdown-toc-thirteen">13、重复使用的调用结果，事先保存到局部变量</a></li>
  <li><a href="#fourteen" id="markdown-toc-fourteen">14、注意NodeList</a></li>
  <li><a href="#fifteen" id="markdown-toc-fifteen">15、避免双重解释</a></li>
  <li><a href="#sixteen" id="markdown-toc-sixteen">16、条件分支</a></li>
  <li><a href="#seventeen" id="markdown-toc-seventeen">17、使用常量</a></li>
  <li><a href="#erighteen" id="markdown-toc-erighteen">18、条件分支</a></li>
  <li><a href="#nineteen" id="markdown-toc-nineteen">19、避免全局量</a></li>
  <li><a href="#twenty" id="markdown-toc-twenty">20、松散耦合</a></li>
  <li><a href="#twenty-one" id="markdown-toc-twenty-one">21、性能方面的注意事项</a></li>
  <li><a href="#twenty-two" id="markdown-toc-twenty-two">22、==和===的区别</a></li>
  <li><a href="#twenty-three" id="markdown-toc-twenty-three">23、何时用单引号，何时用双引号</a></li>
  <li><a href="#twenty-four" id="markdown-toc-twenty-four">24、何时用单引号，何时用双引号</a></li>
</ul>

<h1 id="one">1、避免全局查找</h1>
<p>函数中将全局变量赋值给局部变量以减少全局查找次数，因为访问局部变量的速度要比访问全局变量的速度快些</p>
<div class="language-js highlighter-rouge">
    <pre class="highlight">
        <code>
function search() {
    //当我要使用当前页面地址和主机域名
    alert(window.location.href + window.location.host);
}

//最好的方式是如下这样  先用一个简单变量保存起来
function search() {
    var location = window.location;
    alert(location.href + location.host);
}
        </code>
    </pre>
</div>

<h1 id="two">2、定时器</h1>
<p>如果是需要不断运行的代码，则应该使用setInterval而不是setTimeout,因为setTimeout每一次都会初始化一个定时器，而setinterval只会在开始的时候初始化一个定时器</p>
<div class="language-js highlighter-rouge">
    <pre class="highlight">
        <code>
var timeoutTimes = 0;
function timeout() {
    timeoutTimes++;
    if (timeoutTimes &lt; 10) {
        setTimeout(timeout, 10);
    }
}
timeout();

//可以替换为：
var intervalTimes = 0;
function interval() {
    intervalTimes++;
    if (intervalTimes &gt;= 10) {
        clearInterval(interv);
    }
}
var interv = setInterval(interval, 10);
        </code>
    </pre>
</div>

<h1 id="three">3、字符串连接</h1>
<p>如果要连接多个字符串，应该少使用+=，如</p>
<div class="language-js highlighter-rouge">
    <pre class="highlight">
        <code>
s+=a;

s+=b;

s+=c;

应该写成s+=a + b + c；
        </code>
    </pre>
</div>
<p>而如果是收集字符串，比如多次对同一个字符串进行+=操作的话，最好使用一个缓存，使用JavaScript数组来收集，最后使用join方法连接起来</p>
<div class="language-js highlighter-rouge">
    <pre class="highlight">
        <code>
var buf = [];
for (var i = 0; i &lt; 100; i++) {
    buf.push(i.toString());
}
var all = buf.join("");
        </code>
    </pre>
</div>

<h1 id="four">4、数字转换成字符串</h1>
<p>最好使用”” + 1来将数字转换成字符串，性能上来说</p>
<div class="language-js highlighter-rouge">
    <pre class="highlight">
        <code>
("" +) &gt; String() &gt; .toString() &gt; new String()
        </code>
    </pre>
</div>

<h1 id="five">5、浮点数转换成整型</h1>
<p>很多人喜欢使用parseInt()，其实parseInt()是用于将字符串转换成数字，而不是浮点数和整型之间的转换，我们应该使用Math.floor()或者Math.round()</p>
<div class="language-js highlighter-rouge">
    <pre class="highlight">
        <code>
("" +) &gt; String() &gt; .toString() &gt; new String()
        </code>
    </pre>
</div>

<h1 id="six">6、多个类型声明</h1>
<p>JavaScript中所有变量都可以使用单个var语句来声明,但是可以将他们组合在一起进行声明，以减少整个脚本的执行时间</p>
<div class="language-js highlighter-rouge">
    <pre class="highlight">
        <code>
var myVar = "3.14159",
        str = "" + myVar, //  to string
        i_int = ~ ~myVar,  //  to integer
        f_float = 1 * myVar,  //  to float
        b_bool = !!myVar,  /*  to boolean - any string with length
                                and any number except 0 are true */
        array = [myVar];  //  to array
        </code>
    </pre>
</div>

<h1 id="seven">7、插入迭代器</h1>
<p>如var name=values[i]; i++;前面两条语句可以写成var name=values[i++]&lt;div class="language-js highlighter-rouge"&gt;</p>

<h1 id="eight">8、使用直接量</h1>
<div>
    <pre class="highlight">
        <code>
var aTest = new Array(); //替换为
var aTest = [];
var aTest = new Object; //替换为
var aTest = {};
var reg = new RegExp(); //替换为
var reg = /../;
//如果要创建具有一些特性的一般对象，也可以使用字面量，如下：
var oFruit = new O;
oFruit.color = "red";
oFruit.name = "apple";
//前面的代码可用对象字面量来改写成这样：
var oFruit = { color: "red", name: "apple" };
        </code>
    </pre>
</div>

<h1 id="nine">9、使用DocumentFragment优化多次append</h1>
<p>一旦需要更新DOM,请考虑使用文档碎片来构建DOM结构，然后再将其添加到现存的文档中。</p>

<div>
    <pre class="highlight">
        <code>
for (var i = 0; i &lt; 1000; i++) {
    var el = document.createElement('p');
    el.innerHTML = i;
    document.body.appendChild(el);
}

//可以替换为：
var frag = document.createDocumentFragment();
for (var i = 0; i &lt; 1000; i++) {
    var el = document.createElement('p');
    el.innerHTML = i;
    frag.appendChild(el);
}
document.body.appendChild(frag);
        </code>
    </pre>
</div>

<h1 id="ten">10、使用一次innerHTML赋值代替构建dom元素</h1>
<p>对于大的DOM更改，使用innerHTML要比使用标准的DOM方法创建同样的DOM结构快得多。</p>

<div>
    <pre class="highlight">
        <code>
var frag = document.createDocumentFragment();
for (var i = 0; i &lt; 1000; i++) {
    var el = document.createElement('p');
    el.innerHTML = i;
    frag.appendChild(el);
}
document.body.appendChild(frag);
//可以替换为：
var html = [];
for (var i = 0; i &lt; 1000; i++) {
    html.push("<p>" + i + "</p>");
}
document.body.innerHTML = html.join('');
        </code>
    </pre>
</div>

<h1 id="eleven">11、使用firstChild和nextSibling代替childNodes遍历dom元素</h1>

<div>
    <pre class="highlight">
        <code>
var nodes = element.childNodes;
for (var i = 0, l = nodes.length; i &lt; l; i++) {
    var node = nodes[i];
    //……
}
//可以替换为：
var node = element.firstChild;
while (node) {
    //……
    node = node.nextSibling;
        </code>
    </pre>
</div>

<h1 id="twelve">12、删除DOM节点</h1>
<p>删除dom节点之前,一定要删除注册在该节点上的事件,不管是用observe方式还是用attachEvent方式注册的事件,否则将会产生无法回收的内存。另外，在removeChild和innerHTML=’’二者之间,尽量选择后者. 因为在sIEve(内存泄露监测工具)中监测的结果是用removeChild无法有效地释放dom节点</p>

<h1 id="thirteen">13、重复使用的调用结果，事先保存到局部变量</h1>

<div>
    <pre class="highlight">
        <code>
//避免多次取值的调用开销
var h1 = element1.clientHeight + num1;
var h4 = element1.clientHeight + num2;

//可以替换为：
var eleHeight = element1.clientHeight;
var h1 = eleHeight + num1;
var h4 = eleHeight + num2;
        </code>
    </pre>
</div>

<h1 id="fourteen">14、注意NodeList</h1>
<p>最小化访问NodeList的次数可以极大的改进脚本的性能</p>

<div>
    <pre class="highlight">
        <code>
var images = document.getElementsByTagName('img');
for (var i = 0, len = images.length; i &lt; len; i++) {

}
        </code>
    </pre>
</div>

<p>编写JavaScript的时候一定要知道何时返回NodeList对象，这样可以最小化对它们的访问</p>

<p>进行了对getElementsByTagName()的调用
获取了元素的childNodes属性
获取了元素的attributes属性
访问了特殊的集合，如document.forms、document.images等等
要了解了当使用NodeList对象时，合理使用会极大的提升代码执行速度</p>

<h1 id="fifteen">15、避免双重解释</h1>
<p>不要给setTimeout或者setInterval传递字符串参数</p>

<div>
    <pre class="highlight">
        <code>
var num = 0;
setTimeout('num++', 10);
//可以替换为：
var num = 0;
function addNum() {
    num++;
}
setTimeout(addNum, 10);
        </code>
    </pre>
</div>

<h1 id="sixteen">16、条件分支</h1>
<ul>
<li>将条件分支，按可能性顺序从高到低排列：可以减少解释器对条件的探测次数</li>
<li>在同一条件子的多（&gt;2）条件分支时，使用switch优于if：switch分支选择的效率高于if，在IE下尤为明显。4分支的测试，IE下switch的执行时间约为if的一半。</li>
<li>使用三元运算符替代条件分支</li>
</ul>
<div>
    <pre class="highlight">
        <code>
if (a &gt; b) {
    num = a;
} else {
    num = b;
}
//可以替换为：
num = a &gt; b ? a : b;
         </code>
    </pre>
</div>

<h1 id="seventeen">17、使用常量</h1>
<ul>
<li>重复值:任何在多处用到的值都应该抽取为一个常量</li>
<li>用户界面字符串:任何用于显示给用户的字符串，都应该抽取出来以方便国际化</li>
<li>URLs:在Web应用中，资源位置很容易变更，所以推荐用一个公共地方存放所有的URL</li>
<li>任意可能会更改的值:每当你用到字面量值的时候，你都要问一下自己这个值在未来是不是会变化，如果答案是“是”，那么这个值就应该被提取出来作为一个常量。</li>
</ul>

<h1 id="erighteen">18、条件分支</h1>
<ul>
<li>将条件分支，按可能性顺序从高到低排列：可以减少解释器对条件的探测次数</li>
<li>在同一条件子的多（&gt;2）条件分支时，使用switch优于if：switch分支选择的效率高于if，在IE下尤为明显。4分支的测试，IE下switch的执行时间约为if的一半。</li>
<li>使用三元运算符替代条件分支</li>
</ul>
<div>
    <pre class="highlight">
        <code>
if (a &gt; b) {
    num = a;
} else {
    num = b;
}
//可以替换为：
num = a &gt; b ? a : b;
         </code>
    </pre>
</div>

<h1 id="nineteen">19、避免全局量</h1>
<p>全局变量应该全部字母大写，各单词之间用_下划线来连接。尽可能避免全局变量和函数, 尽量减少全局变量的使用，因为在一个页面中包含的所有JavaScript都在同一个域中运行。所以如果你的代码中声明了全局变量或者全局函数的话，后面的代码中载入的脚本文件中的同名变量和函数会覆盖掉（overwrite）你的。</p>

<div>
    <pre class="highlight">
        <code>
//糟糕的全局变量和全局函数
var current = null;
function init(){
//...
}
function change() {
    //...
}
function verify() {
    //...
}
//解决办法有很多，Christian Heilmann建议的方法是：
//如果变量和函数不需要在“外面”引用，那么就可以使用一个没有名字的方法将他们全都包起来。
(function(){
var current = null;
function init() {
    //...
}
function change() {
    //...
}
function verify() {
    //...
}
})();
//如果变量和函数需要在“外面”引用，需要把你的变量和函数放在一个“命名空间”中
//我们这里用一个function做命名空间而不是一个var，因为在前者中声明function更简单，而且能保护隐私数据
myNameSpace = function() {
    var current = null;

    function init() {
        //...
    }

    function change() {
        //...
    }

    function verify() {
        //...
    }

//所有需要在命名空间外调用的函数和属性都要写在return里面
    return {
        init: init,
        //甚至你可以为函数和属性命名一个别名
        set: change
    };
};
         </code>
    </pre>
</div>

<h1 id="twenty">20、松散耦合</h1>
<p>解耦CSS/JavaScript</p>

<p>显示问题的唯一来源应该是CSS，行为问题的唯一来源应该是JavaScript，层次之间保持松散耦合才可以让你的应用程序更加易于维护，所以像以下的代码element.style.color=”red”尽量改为element.className=”edit”，而且不要在css中通过表达式嵌入JavaScript</p>

<h1 id="twenty-one">21、性能方面的注意事项</h1>
<p>1、尽量使用原生方法</p>

<p>2、switch语句相对if较快</p>

<p>通过将case语句按照最可能到最不可能的顺序进行组织</p>

<p>3、巧用||和&amp;&amp;布尔运算符</p>
<div>
    <pre class="highlight">
        <code>
function eventHandler(e) {
    if (!e) e = window.event;
}
//可以替换为：
function eventHandler(e) {
    e = e || window.event;
}

if (myobj) {
    doSomething(myobj);
}
//可以替换为：
myobj &amp;&amp; doSomething(myobj);
         </code>
    </pre>
</div>

<h1 id="twenty-two">22、==和===的区别</h1>
<p>避免在if和while语句的条件部分进行赋值，如if (a = b)，应该写成if (a == b)，但是在比较是否相等的情况下，最好使用全等运行符，也就是使用===和!==操作符会相对于==和!=会好点。==和!=操作符会进行类型强制转换</p>

<div>
    <pre class="highlight">
        <code>
var valueA = "1";
var valueB = 1;
if (valueA == valueB) {
    alert("Equal");
}
else {
    alert("Not equal");
}
//output: "Equal"
if (valueA === valueB) {
    alert("Equal");
}
else {
    alert("Not equal");
}
//output: "Not equal"
         </code>
    </pre>
</div>

<h1 id="twenty-three">23、何时用单引号，何时用双引号</h1>
<p>虽然在JavaScript当中，双引号和单引号都可以表示字符串, 为了避免混乱，我们建议在HTML中使用双引号，在JavaScript中使用单引号，但为了兼容各个浏览器，也为了解析时不会出错，定义JSON对象时，最好使用双引号</p>

<h1 id="twenty-four">24、何时用单引号，何时用双引号</h1>
<p>虽然在JavaScript当中，双引号和单引号都可以表示字符串, 为了避免混乱，我们建议在HTML中使用双引号，在JavaScript中使用单引号，但为了兼容各个浏览器，也为了解析时不会出错，定义JSON对象时，最好使用双引号</p>

<div>
    <pre class="highlight">
        <code>
var valueA = "1";
var valueB = 1;
if (valueA == valueB) {
    alert("Equal");
}
else {
    alert("Not equal");
}
//output: "Equal"
if (valueA === valueB) {
    alert("Equal");
}
else {
    alert("Not equal");
}
//output: "Not equal"
         </code>
    </pre>
</div>

            </article>
        </div>
      </div>
    </div>
  </div>
</div>

    
    <footer class="footer" role="contentinfo">
	<div class="container">
		<div class="footer-links">
			<span>
				我的网站展示：
			</span>
			<span>
				<a href="http://www.thisisme1228.com/">百家书（电脑上看）</a>
			</span>
			<span>&nbsp;|&nbsp;</span>
			<span>
				<a href="http://music.thisisme1228.com/index.html#/recommend">音乐网(手机上看)</a>
			</span>
		</div>
		<div style="margin-bottom: 12px">Copyright © 2017 <a href="JavaScript:;">Helene</a> . All rights reserved.</div>
		<p class="copyright">备案证书号：辽ICP备17012545号-1</p>
	</div>
</footer>

<script src="/styles/js/jquery.min.js"></script>
<script src="/styles/js/bootstrap.min.js"></script>
<script src="/styles/js/holder.min.js"></script>
<script src="/styles/js/lessismore.js"></script>
<script src="/styles/js/application.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  </body>
</html>
